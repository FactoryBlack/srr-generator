<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>I Wanna Lockpick Puzzle Solver</title>
    <style>
        .console-output {
            width: 100%;
            height: 300px;
            overflow-y: auto;
            background-color: #333;
            color: #eee;
            font-family: monospace;
            padding: 10px;
            border: 1px solid #222;
            white-space: pre-line;
        }

        #startButton {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>

<h1>I Wanna Lockpick Puzzle Solver</h1>
<button id="startButton">Start Solver</button>
<div id="log" class="console-output"></div>

<script>
// Initial puzzle data with frozen doors and aura requirement
const puzzleData = {
    keys: { green: 0, red: 0, cyan: 0 },
    doors: [
        { color: 'green', type: 'normal', copies: 1, lock: { type: 'normal', cost: 5 } },
        { color: 'red', type: 'frozen', copies: 1, lock: { type: 'normal', cost: 3 }, defrosted: false },
        { color: 'cyan', type: 'aura', copies: 1, lock: { type: 'normal', cost: 7 }, auraNeeded: true, auraActive: false }
    ],
    keysToCollect: [
        { color: 'green', amount: 5 },
        { color: 'red', amount: 3 },
        { color: 'cyan', amount: 7 }
    ],
    goal: { reached: false }
};

let logDiv = document.getElementById("log");

// Function to log messages with auto-scroll
function logMessage(message) {
    logDiv.textContent += message + "\n";
    logDiv.scrollTop = logDiv.scrollHeight;
}

// Utility function to clone data without reference issues
function cloneData(data) {
    return JSON.parse(JSON.stringify(data));
}

// Collect a specific key amount and log
function collectKey(data, color, amount) {
    data.keys[color] += amount;
    logMessage(`Collected ${amount} ${color} key(s). Total: ${data.keys[color]}`);
}

// Open a door if possible and log result
function openDoor(data, door) {
    // Check if door is frozen and needs defrosting
    if (door.type === 'frozen' && !door.defrosted) {
        if (data.keys.red >= 1) {
            data.keys.red -= 1;
            door.defrosted = true;
            logMessage(`Defrosted red frozen door.`);
        } else {
            logMessage(`Not enough red keys to defrost the frozen door.`);
            return false;
        }
    }

    // Check if door needs an aura to open
    if (door.auraNeeded && !data.auraActive) {
        logMessage(`Door requires aura effect to open.`);
        return false;
    }

    if (data.keys[door.color] >= door.lock.cost) {
        data.keys[door.color] -= door.lock.cost;
        door.copies -= 1;
        logMessage(`Opened ${door.color} door. Remaining copies: ${door.copies}`);
        return true;
    } else {
        logMessage(`Not enough ${door.color} keys to open the door.`);
        return false;
    }
}

// Activate aura if enough cyan keys are collected
function checkAuraActivation(data) {
    if (data.keys.cyan >= 7 && !data.auraActive) {
        data.auraActive = true;
        logMessage("Aura activated! Nearby doors can now be affected.");
    }
}

// Check if all doors are open to reach the goal
function checkGoal(data) {
    const allDoorsOpen = data.doors.every(door => door.copies <= 0);
    if (allDoorsOpen) {
        data.goal.reached = true;
        logMessage("Goal reached! All doors are open.");
    } else {
        logMessage("Goal not yet reached.");
    }
}

// Test function to simulate puzzle solving with frozen doors and aura mechanic
async function advancedTest() {
    logMessage("Starting advanced test with frozen door and aura requirement...");

    const testData = cloneData(puzzleData);
    const steps = [];

    // Step 1: Collect green keys and attempt to open the green door
    collectKey(testData, 'green', 5);
    if (openDoor(testData, testData.doors[0])) {
        steps.push("Opened green door.");
    }

    // Step 2: Collect red keys and attempt to defrost and open the red frozen door
    collectKey(testData, 'red', 3);
    if (openDoor(testData, testData.doors[1])) {
        steps.push("Defrosted and opened red door.");
    }

    // Step 3: Collect cyan keys to activate aura and open the cyan door
    collectKey(testData, 'cyan', 7);
    checkAuraActivation(testData);
    if (openDoor(testData, testData.doors[2])) {
        steps.push("Opened cyan door with aura.");
    }

    // Step 4: Check if goal is reached
    checkGoal(testData);

    if (testData.goal.reached) {
        logMessage("Test succeeded. Path: " + steps.join(" -> "));
    } else {
        logMessage("Test failed. Goal was not reached.");
    }
}

// Add event listener to the button to start the test
document.getElementById("startButton").addEventListener("click", () => {
    logDiv.textContent = ""; // Clear previous logs
    advancedTest(); // Start the advanced test
});
</script>

</body>
</html>
